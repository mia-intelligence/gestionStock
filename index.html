<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIA Intelligence - Gestion Bar & Stock</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∏</text></svg>">
<script>console.warn=function(){};</script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;
const I={Plus:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,Trash:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,Edit:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,Pkg:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>,Trend:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,Alert:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/></svg>,Dollar:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,Dl:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,Srch:({s=20})=><svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>};
function App(){const[t,setT]=useState('d'),[igs,setIgs]=useState([]),[rcs,setRcs]=useState([]),[sIF,setSIF]=useState(false),[sRF,setSRF]=useState(false),[eI,setEI]=useState(null),[eR,setER]=useState(null),[q,setQ]=useState(''),[mg,setMg]=useState(70),[nI,setNI]=useState({n:'',c:'Alcools',p:0,u:'cl',s:0,m:0}),[nR,setNR]=useState({n:'',t:'Cocktail',pv:0,is:[]});useEffect(()=>{const si=localStorage.getItem('mia_i'),sr=localStorage.getItem('mia_r');if(si)setIgs(JSON.parse(si));if(sr)setRcs(JSON.parse(sr));},[]);useEffect(()=>{localStorage.setItem('mia_i',JSON.stringify(igs))},[igs]);useEffect(()=>{localStorage.setItem('mia_r',JSON.stringify(rcs))},[rcs]);const cs=['Alcools','Vins','Bi√®res','Softs','Jus','Sirops','Fruits','Herbes','√âpices','Autres'],ts=['Cocktail','Soft','Bi√®re','Vin','Plat','Entr√©e','Dessert'],us=['cl','ml','L','g','kg','unit√©','tranche','feuille'];const svI=()=>{if(!nI.n)return alert('Nom requis');if(eI!==null){const u=[...igs];u[eI]={...nI,id:igs[eI].id};setIgs(u);setEI(null)}else{setIgs([...igs,{...nI,id:Date.now()}])}setNI({n:'',c:'Alcools',p:0,u:'cl',s:0,m:0});setSIF(false)};const dlI=(i)=>{if(confirm('Supprimer?'))setIgs(igs.filter((_,x)=>x!==i))};const addRI=()=>setNR({...nR,is:[...nR.is,{ii:null,q:0}]});const updRI=(i,f,v)=>{const u=[...nR.is];u[i][f]=v;setNR({...nR,is:u})};const dlRI=(i)=>setNR({...nR,is:nR.is.filter((_,x)=>x!==i)});const calcC=(ri)=>ri.reduce((tot,r)=>{const ig=igs.find(i=>i.id===parseInt(r.ii));return ig?tot+(ig.p*r.q):tot},0);const svR=()=>{if(!nR.n)return alert('Nom requis');if(nR.is.length===0)return alert('Ajoutez des ingr√©dients');const c=calcC(nR.is),m=nR.pv>0?((nR.pv-c)/nR.pv*100):0;if(eR!==null){const u=[...rcs];u[eR]={...nR,id:rcs[eR].id,c,m};setRcs(u);setER(null)}else{setRcs([...rcs,{...nR,id:Date.now(),c,m}])}setNR({n:'',t:'Cocktail',pv:0,is:[]});setSRF(false)};const dlR=(i)=>{if(confirm('Supprimer?'))setRcs(rcs.filter((_,x)=>x!==i))};const calcPS=(c)=>(c/(1-mg/100)).toFixed(2);const st={al:igs.filter(i=>i.s<=i.m),mm:rcs.length>0?rcs.reduce((s,r)=>s+r.m,0)/rcs.length:0};const expCSV=()=>{let csv="MIA Intelligence Export\n\nINGREDIENTS\nNom,Cat,Prix,Unit,Stock,Min\n";igs.forEach(i=>csv+=`${i.n},${i.c},${i.p},${i.u},${i.s},${i.m}\n`);csv+="\nRECETTES\nNom,Type,PV,Cout,Marge\n";rcs.forEach(r=>csv+=`${r.n},${r.t},${r.pv},${r.c.toFixed(2)},${r.m.toFixed(1)}\n`);const blob=new Blob([csv],{type:'text/csv'}),a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='mia_export.csv';a.click()};const fI=igs.filter(i=>i.n.toLowerCase().includes(q.toLowerCase())),fR=rcs.filter(r=>r.n.toLowerCase().includes(q.toLowerCase()));return(<div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900"><div className="bg-gray-900 text-white p-4 md:p-6 shadow-2xl"><div className="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4"><div><h1 className="text-2xl md:text-3xl font-bold">üç∏ MIA Intelligence</h1><p className="text-gray-400 text-sm">Gestion Bar & Stock</p></div><button onClick={expCSV} className="flex items-center gap-2 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-semibold"><I.Dl s={18}/>Export</button></div></div><div className="bg-gray-800 border-b border-gray-700 overflow-x-auto"><div className="max-w-7xl mx-auto flex">{[{i:'d',l:'üìä Dashboard',ic:I.Trend},{i:'i',l:'ü•É Ingr√©dients',ic:I.Pkg},{i:'r',l:'üìñ Recettes',ic:I.Dollar}].map(tb=><button key={tb.i} onClick={()=>setT(tb.i)} className={`flex items-center gap-2 px-4 md:px-6 py-3 font-semibold whitespace-nowrap text-sm ${t===tb.i?'bg-purple-600 text-white border-b-4 border-purple-400':'text-gray-400 hover:bg-gray-700'}`}><tb.ic s={18}/>{tb.l}</button>)}</div></div><div className="max-w-7xl mx-auto p-4 md:p-6">{t==='d'&&<div className="space-y-6"><div className="grid grid-cols-2 lg:grid-cols-4 gap-4">{[{l:'Ingr√©dients',v:igs.length,i:I.Pkg},{l:'Recettes',v:rcs.length,i:I.Dollar},{l:'Marge Moy.',v:st.mm.toFixed(1)+'%',i:I.Trend},{l:'Alertes',v:st.al.length,i:I.Alert}].map((s,i)=><div key={i} className="bg-white rounded-xl p-4 md:p-6 shadow-lg"><p className="text-gray-500 text-xs md:text-sm font-semibold">{s.l}</p><div className="flex justify-between items-center mt-2"><p className="text-2xl md:text-3xl font-bold">{s.v}</p><s.i s={32}/></div></div>)}</div>{st.al.length>0&&<div className="bg-red-50 border-l-4 border-red-500 rounded-lg p-4"><h3 className="font-bold text-red-900 mb-3 flex items-center gap-2"><I.Alert/>‚ö†Ô∏è Stocks Faibles</h3><div className="space-y-2">{st.al.map((ig,i)=><div key={i} className="flex justify-between bg-white p-3 rounded text-sm"><span className="font-semibold">{ig.n}</span><span>Stock: <span className="text-red-600 font-bold">{ig.s}{ig.u}</span> / Min: {ig.m}{ig.u}</span></div>)}</div></div>}<div className="bg-white rounded-xl p-4 md:p-6 shadow-lg"><h3 className="text-lg font-bold mb-4 flex items-center gap-2"><I.Trend/>Top Recettes</h3>{rcs.sort((a,b)=>b.m-a.m).slice(0,5).map((r,i)=><div key={i} className="flex justify-between p-3 bg-gray-50 rounded mb-2"><div><p className="font-semibold">{r.n}</p><p className="text-xs text-gray-500">{r.t}</p></div><div className="text-right"><p className="text-lg font-bold text-green-600">{r.m.toFixed(1)}%</p><p className="text-xs text-gray-500">{r.c.toFixed(2)}‚Ç¨‚Üí{r.pv}‚Ç¨</p></div></div>)}{rcs.length===0&&<p className="text-gray-500 text-center py-8">Aucune recette</p>}</div><div className="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-4 text-white"><h3 className="text-lg font-bold mb-4">üßÆ Calculateur Prix</h3><div className="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label className="block text-sm font-semibold mb-2">Marge Objectif (%)</label><input type="number" value={mg} onChange={e=>setMg(parseFloat(e.target.value)||0)} className="w-full px-4 py-2 rounded-lg text-gray-900 font-semibold"/></div><div className="md:col-span-2 flex items-end"><div className="bg-white/20 rounded-lg p-4 w-full"><p className="text-sm mb-1">Co√ªt 3‚Ç¨ avec {mg}% marge</p><p className="text-xl font-bold">Prix: {calcPS(3)}‚Ç¨</p></div></div></div></div></div>}{t==='i'&&<div className="space-y-6"><div className="flex flex-col md:flex-row gap-4"><div className="relative flex-1"><I.Srch s={18}/><input type="text" placeholder="Rechercher..." value={q} onChange={e=>setQ(e.target.value)} className="w-full pl-10 pr-4 py-2 rounded-lg border-2 focus:border-purple-500 outline-none"/></div><button onClick={()=>{setSIF(true);setEI(null);setNI({n:'',c:'Alcools',p:0,u:'cl',s:0,m:0})}} className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-semibold whitespace-nowrap"><I.Plus/>Nouvel Ingr√©dient</button></div>{sIF&&<div className="bg-white rounded-xl p-4 shadow-lg border-2 border-purple-500"><h3 className="text-xl font-bold mb-4">{eI!==null?'Modifier':'Nouvel'} Ingr√©dient</h3><div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label className="block text-sm font-semibold mb-2">Nom *</label><input type="text" value={nI.n} onChange={e=>setNI({...nI,n:e.target.value})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none" placeholder="Ex: Rhum"/></div><div><label className="block text-sm font-semibold mb-2">Cat√©gorie</label><select value={nI.c} onChange={e=>setNI({...nI,c:e.target.value})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none">{cs.map(c=><option key={c}>{c}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Prix (‚Ç¨)</label><input type="number" step="0.01" value={nI.p} onChange={e=>setNI({...nI,p:parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Unit√©</label><select value={nI.u} onChange={e=>setNI({...nI,u:e.target.value})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none">{us.map(u=><option key={u}>{u}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Stock</label><input type="number" value={nI.s} onChange={e=>setNI({...nI,s:parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Stock Min</label><input type="number" value={nI.m} onChange={e=>setNI({...nI,m:parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none"/></div></div><div className="flex gap-3"><button onClick={svI} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-semibold">Enregistrer</button><button onClick={()=>{setSIF(false);setEI(null)}} className="bg-gray-300 hover:bg-gray-400 px-6 py-2 rounded-lg font-semibold">Annuler</button></div></div>}<div className="bg-white rounded-xl shadow-lg overflow-x-auto"><table className="w-full text-sm"><thead className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white"><tr>{['Nom','Cat','Prix','Stock','Min','Actions'].map(h=><th key={h} className="px-4 py-3 text-left font-semibold">{h}</th>)}</tr></thead><tbody>{fI.map((ig,i)=><tr key={ig.id} className="border-b hover:bg-gray-50"><td className="px-4 py-3 font-semibold">{ig.n}</td><td className="px-4 py-3 text-gray-600">{ig.c}</td><td className="px-4 py-3">{ig.p.toFixed(2)}‚Ç¨/{ig.u}</td><td className={`px-4 py-3 font-semibold ${ig.s<=ig.m?'text-red-600':'text-green-600'}`}>{ig.s}{ig.u}</td><td className="px-4 py-3">{ig.m}{ig.u}</td><td className="px-4 py-3"><div className="flex gap-2"><button onClick={()=>{setEI(igs.findIndex(x=>x.id===ig.id));setNI(ig);setSIF(true)}} className="p-2 bg-blue-100 rounded hover:bg-blue-200"><I.Edit s={14}/></button><button onClick={()=>dlI(igs.findIndex(x=>x.id===ig.id))} className="p-2 bg-red-100 rounded hover:bg-red-200"><I.Trash s={14}/></button></div></td></tr>)}</tbody></table>{fI.length===0&&<div className="p-12 text-center text-gray-500">Aucun ingr√©dient</div>}</div></div>}{t==='r'&&<div className="space-y-6"><div className="flex flex-col md:flex-row gap-4"><div className="relative flex-1"><I.Srch s={18}/><input type="text" placeholder="Rechercher..." value={q} onChange={e=>setQ(e.target.value)} className="w-full pl-10 pr-4 py-2 rounded-lg border-2 focus:border-purple-500 outline-none"/></div><button onClick={()=>{setSRF(true);setER(null);setNR({n:'',t:'Cocktail',pv:0,is:[]})}} className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-semibold whitespace-nowrap"><I.Plus/>Nouvelle Recette</button></div>{sRF&&<div className="bg-white rounded-xl p-4 shadow-lg border-2 border-purple-500"><h3 className="text-xl font-bold mb-4">{eR!==null?'Modifier':'Nouvelle'} Recette</h3><div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label className="block text-sm font-semibold mb-2">Nom *</label><input type="text" value={nR.n} onChange={e=>setNR({...nR,n:e.target.value})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none" placeholder="Ex: Mojito"/></div><div><label className="block text-sm font-semibold mb-2">Type</label><select value={nR.t} onChange={e=>setNR({...nR,t:e.target.value})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none">{ts.map(t=><option key={t}>{t}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Prix Vente (‚Ç¨)</label><input type="number" step="0.01" value={nR.pv} onChange={e=>setNR({...nR,pv:parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded-lg focus:border-purple-500 outline-none"/></div></div><div className="mb-4"><div className="flex justify-between mb-3"><label className="font-semibold">Ingr√©dients *</label><button onClick={addRI} className="flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm font-semibold"><I.Plus s={14}/>Ajouter</button></div>{nR.is.length===0&&<p className="text-gray-500 text-center py-4 bg-gray-50 rounded">Ajoutez des ingr√©dients</p>}<div className="space-y-3">{nR.is.map((ri,i)=><div key={i} className="flex gap-3 p-3 bg-gray-50 rounded"><div className="flex-1"><select value={ri.ii||''} onChange={e=>updRI(i,'ii',e.target.value)} className="w-full px-3 py-2 border-2 rounded focus:border-purple-500 outline-none text-sm"><option value="">S√©lectionner...</option>{igs.map(ig=><option key={ig.id} value={ig.id}>{ig.n} ({ig.u})</option>)}</select></div><div className="w-24"><input type="number" step="0.1" value={ri.q} onChange={e=>updRI(i,'q',parseFloat(e.target.value)||0)} className="w-full px-3 py-2 border-2 rounded focus:border-purple-500 outline-none text-sm" placeholder="Qt√©"/></div><button onClick={()=>dlRI(i)} className="p-2 bg-red-100 rounded hover:bg-red-200"><I.Trash s={14}/></button></div>)}</div></div>{nR.is.length>0&&<div className="bg-blue-50 rounded-lg p-4 mb-4"><div className="flex justify-between flex-wrap gap-2"><div><p className="text-sm font-semibold text-gray-700">Co√ªt</p><p className="text-2xl font-bold text-blue-600">{calcC(nR.is).toFixed(2)}‚Ç¨</p></div>{nR.pv>0&&<div><p className="text-sm font-semibold text-gray-700">Marge</p><p className="text-2xl font-bold text-green-600">{((nR.pv-calcC(nR.is))/nR.pv*100).toFixed(1)}%</p></div>}<div><p className="text-sm font-semibold text-gray-700">Prix sugg√©r√© ({mg}%)</p><p className="text-2xl font-bold text-purple-600">{calcPS(calcC(nR.is))}‚Ç¨</p></div></div></div>}<div className="flex gap-3"><button onClick={svR} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-semibold">Enregistrer</button><button onClick={()=>{setSRF(false);setER(null)}} className="bg-gray-300 hover:bg-gray-400 px-6 py-2 rounded-lg font-semibold">Annuler</button></div></div>}<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{fR.map((r,i)=><div key={r.id} className="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition"><div className="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white"><div className="flex justify-between"><div><h4 className="text-xl font-bold">{r.n}</h4><p className="text-sm text-purple-200">{r.t}</p></div><span className="bg-white/20 px-3 py-1 rounded-full text-sm font-semibold">{r.pv}‚Ç¨</span></div></div><div className="p-4"><div className="space-y-2 mb-4"><div className="flex justify-between text-sm"><span className="text-gray-600">Co√ªt</span><span className="font-semibold">{r.c.toFixed(2)}‚Ç¨</span></div><div className="flex justify-between text-sm"><span className="text-gray-600">Marge</span><span className={`font-semibold ${r.m>=mg?'text-green-600':'text-orange-600'}`}>{r.m.toFixed(1)}%</span></div><div className="flex justify-between text-sm"><span className="text-gray-600">B√©n√©fice</span><span className="font-semibold">{(r.pv-r.c).toFixed(2)}‚Ç¨</span></div></div><div className="border-t pt-3 mb-3"><p className="text-xs font-semibold text-gray-700 mb-2">Composition:</p><div className="space-y-1">{r.is.map((ri,i)=>{const ig=igs.find(ig=>ig.id===parseInt(ri.ii));return ig?<div key={i} className="text-xs text-gray-600 flex justify-between"><span>{ig.n}</span><span className="font-semibold">{ri.q}{ig.u}</span></div>:null})}</div></div><div className="flex gap-2"><button onClick={()=>{setER(rcs.findIndex(x=>x.id===r.id));setNR(r);setSRF(true)}} className="flex-1 flex items-center justify-center gap-2 bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg font-semibold text-sm"><I.Edit s={16}/>Modifier</button><button onClick={()=>dlR(rcs.findIndex(x=>x.id===r.id))} className="flex-1 flex items-center justify-center gap-2 bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg font-semibold text-sm"><I.Trash s={16}/>Supprimer</button></div></div></div>)}</div>{fR.length===0&&<div className="bg-white rounded-xl p-12 text-center"><I.Dollar s={48}/><p className="text-lg font-semibold text-gray-500 mt-4">Aucune recette</p></div>}</div>}</div></div>)}ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
