<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIA Intelligence V2</title>
<script>console.warn=function(){};</script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;
const TOKEN='patiIQseU3tQgJ2dh.bdfc3827ae92ec40f8ab984606f6a0a094750191cf74812f1c82618f2cc4bf33';
const BASE='appOcMcPHUiZ5Eylq';
const api={async req(t,m='GET',d=null,id=null){const u=id?`https://api.airtable.com/v0/${BASE}/${encodeURIComponent(t)}/${id}`:`https://api.airtable.com/v0/${BASE}/${encodeURIComponent(t)}`;const o={method:m,headers:{'Authorization':`Bearer ${TOKEN}`,'Content-Type':'application/json'}};if(d)o.body=JSON.stringify(d);const r=await fetch(u,o);if(!r.ok)throw new Error(`API error: ${r.status}`);return r.json()},async get(t){const d=await this.req(t);return d.records||[]},async create(t,f){return await this.req(t,'POST',{fields:f})},async update(t,id,f){return await this.req(t,'PATCH',{fields:f},id)},async del(t,id){await this.req(t,'DELETE',null,id)}};
const I={Plus:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,Trash:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/></svg>,Edit:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,Pkg:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>,Trend:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/></svg>,Refresh:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/></svg>,Cloud:()=><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>};
function App(){const[t,setT]=useState('d'),[ms,setMs]=useState([]),[rs,setRs]=useState([]),[ps,setPs]=useState([]),[ld,setLd]=useState(true),[sy,setSy]=useState(false),[sf,setSf]=useState(false),[rf,setRf]=useState(false),[pf,setPf]=useState(false),[ei,setEi]=useState(null),[er,setEr]=useState(null),[ep,setEp]=useState(null),[q,setQ]=useState(''),[nm,setNm]=useState({Nom:'',Cat√©gorie:'Alcools forts/ spiriteux',Unit√©:'CL','Prix d\'achat unitaire HT':0,Fournisseur:'',Marque:''}),[nr,setNr]=useState({'Produit / Plat':'',Ingr√©dient:'','Quantit√© utilis√©e':0,'Unit√© utilis√©e':'CL'}),[np,setNp]=useState({'Produit / Plat':'',Structure:'BAR',Type:'Cocktail','Prix de vente (‚Ç¨)':0,'Co√ªt mati√®re (‚Ç¨)':0,'Commission plateforme (%)':0});
const load=async()=>{setLd(true);setSy(true);try{const[a,b,c]=await Promise.all([api.get('Mati√®res premi√®res'),api.get('Recettes / Compositions'),api.get('Produits et plats')]);setMs(a);setRs(b);setPs(c)}catch(e){alert('Erreur connexion Airtable')}finally{setLd(false);setSy(false)}};
useEffect(()=>{load()},[]);
const svm=async()=>{if(!nm.Nom)return alert('Nom requis');setSy(true);try{ei?await api.update('Mati√®res premi√®res',ei,nm):await api.create('Mati√®res premi√®res',nm);await load();setNm({Nom:'',Cat√©gorie:'Alcools forts/ spiriteux',Unit√©:'CL','Prix d\'achat unitaire HT':0,Fournisseur:'',Marque:''});setSf(false);setEi(null)}catch(e){alert('Erreur sauvegarde')}finally{setSy(false)}};
const dlm=async(id)=>{if(!confirm('Supprimer?'))return;setSy(true);try{await api.del('Mati√®res premi√®res',id);await load()}catch(e){alert('Erreur')}finally{setSy(false)}};
const svr=async()=>{if(!nr['Produit / Plat'])return alert('Nom requis');setSy(true);try{er?await api.update('Recettes / Compositions',er,nr):await api.create('Recettes / Compositions',nr);await load();setNr({'Produit / Plat':'',Ingr√©dient:'','Quantit√© utilis√©e':0,'Unit√© utilis√©e':'CL'});setRf(false);setEr(null)}catch(e){alert('Erreur')}finally{setSy(false)}};
const dlr=async(id)=>{if(!confirm('Supprimer?'))return;setSy(true);try{await api.del('Recettes / Compositions',id);await load()}catch(e){alert('Erreur')}finally{setSy(false)}};
const svp=async()=>{if(!np['Produit / Plat'])return alert('Nom requis');setSy(true);try{ep?await api.update('Produits et plats',ep,np):await api.create('Produits et plats',np);await load();setNp({'Produit / Plat':'',Structure:'BAR',Type:'Cocktail','Prix de vente (‚Ç¨)':0,'Co√ªt mati√®re (‚Ç¨)':0,'Commission plateforme (%)':0});setPf(false);setEp(null)}catch(e){alert('Erreur')}finally{setSy(false)}};
const dlp=async(id)=>{if(!confirm('Supprimer?'))return;setSy(true);try{await api.del('Produits et plats',id);await load()}catch(e){alert('Erreur')}finally{setSy(false)}};
const cs=['Boisson soft (sans alcool)','Alcools forts/ spiriteux','Vins','Bi√®res','Produits frais/ p√©rissables','Garnitures & d√©corations','Glace','Consommable / jetables','Produits d\'entretien','Accompagnements / snacking'];
const us=['L','CL','Kg','g','U'];
const sts=['BAR','DARK KITCHEN'];
const tps=['Cocktail','Soft','Bi√®re','Vin','Plat','Entr√©e','Dessert'];
const fm=ms.filter(m=>(m.fields?.Nom||'').toLowerCase().includes(q.toLowerCase()));
const fr=rs.filter(r=>(r.fields?.['Produit / Plat']||'').toLowerCase().includes(q.toLowerCase()));
const fp=ps.filter(p=>(p.fields?.['Produit / Plat']||'').toLowerCase().includes(q.toLowerCase()));
if(ld)return(<div className="min-h-screen bg-gradient-to-br from-purple-900 to-indigo-900 flex items-center justify-center text-white"><div className="text-center"><I.Cloud/><p className="text-2xl font-bold mt-4">Chargement Airtable...</p></div></div>);
return(<div className="min-h-screen bg-gradient-to-br from-purple-900 to-indigo-900"><div className="bg-gray-900 text-white p-4 md:p-6"><div className="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4"><div><h1 className="text-2xl md:text-3xl font-bold flex items-center gap-2">üç∏ MIA Intelligence <span className="text-xs bg-green-500 px-2 py-1 rounded">V2</span></h1><p className="text-gray-400 text-sm">Connect√© √† Airtable</p></div><button onClick={load} disabled={sy} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm font-semibold disabled:opacity-50"><I.Refresh/>{sy?'Synchro...':'Actualiser'}</button></div></div><div className="bg-gray-800 border-b border-gray-700 overflow-x-auto"><div className="max-w-7xl mx-auto flex">{[{i:'d',l:'üìä Dashboard',ic:I.Trend},{i:'m',l:'ü•É Mati√®res',ic:I.Pkg},{i:'r',l:'üìñ Recettes',ic:I.Pkg},{i:'p',l:'üçΩÔ∏è Produits',ic:I.Pkg}].map(tb=><button key={tb.i} onClick={()=>setT(tb.i)} className={`flex items-center gap-2 px-4 md:px-6 py-3 font-semibold whitespace-nowrap text-sm ${t===tb.i?'bg-purple-600 text-white':'text-gray-400 hover:bg-gray-700'}`}><tb.ic/>{tb.l}</button>)}</div></div><div className="max-w-7xl mx-auto p-4 md:p-6">{t==='d'&&<div className="space-y-6"><div className="grid grid-cols-2 lg:grid-cols-3 gap-4">{[{l:'Mati√®res',v:ms.length},{l:'Recettes',v:rs.length},{l:'Produits',v:ps.length}].map((s,i)=><div key={i} className="bg-white rounded-xl p-6 shadow-lg"><p className="text-gray-500 text-sm font-semibold">{s.l}</p><p className="text-3xl font-bold mt-2">{s.v}</p></div>)}</div><div className="bg-green-50 border-l-4 border-green-500 rounded-lg p-4"><div className="flex items-start gap-3"><I.Cloud/><div><h3 className="font-bold text-green-900">‚úÖ Connect√© √† Airtable</h3><p className="text-sm text-green-700 mt-1">Donn√©es synchronis√©es en temps r√©el</p></div></div></div></div>}{t==='m'&&<div className="space-y-6"><div className="flex gap-4"><input type="text" placeholder="Rechercher..." value={q} onChange={e=>setQ(e.target.value)} className="flex-1 px-4 py-2 rounded border-2 outline-none"/><button onClick={()=>{setSf(true);setEi(null);setNm({Nom:'',Cat√©gorie:'Alcools forts/ spiriteux',Unit√©:'CL','Prix d\'achat unitaire HT':0,Fournisseur:'',Marque:''})}} className="flex items-center gap-2 bg-purple-600 text-white px-6 py-2 rounded font-semibold"><I.Plus/>Nouveau</button></div>{sf&&<div className="bg-white rounded-xl p-4 border-2 border-purple-500"><h3 className="text-xl font-bold mb-4">{ei?'Modifier':'Nouveau'}</h3><div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label className="block text-sm font-semibold mb-2">Nom *</label><input type="text" value={nm.Nom} onChange={e=>setNm({...nm,Nom:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Cat√©gorie</label><select value={nm.Cat√©gorie} onChange={e=>setNm({...nm,Cat√©gorie:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none">{cs.map(c=><option key={c}>{c}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Prix (‚Ç¨)</label><input type="number" step="0.01" value={nm['Prix d\'achat unitaire HT']} onChange={e=>setNm({...nm,'Prix d\'achat unitaire HT':parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Unit√©</label><select value={nm.Unit√©} onChange={e=>setNm({...nm,Unit√©:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none">{us.map(u=><option key={u}>{u}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Fournisseur</label><input type="text" value={nm.Fournisseur} onChange={e=>setNm({...nm,Fournisseur:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Marque</label><input type="text" value={nm.Marque} onChange={e=>setNm({...nm,Marque:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div></div><div className="flex gap-3"><button onClick={svm} disabled={sy} className="bg-purple-600 text-white px-6 py-2 rounded font-semibold disabled:opacity-50">{sy?'Sauvegarde...':'Enregistrer'}</button><button onClick={()=>{setSf(false);setEi(null)}} className="bg-gray-300 px-6 py-2 rounded font-semibold">Annuler</button></div></div>}<div className="bg-white rounded-xl shadow-lg overflow-x-auto"><table className="w-full text-sm"><thead className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white"><tr>{['Nom','Cat√©gorie','Prix','Unit√©','Fournisseur','Actions'].map(h=><th key={h} className="px-4 py-3 text-left font-semibold">{h}</th>)}</tr></thead><tbody>{fm.map(m=><tr key={m.id} className="border-b hover:bg-gray-50"><td className="px-4 py-3 font-semibold">{m.fields?.Nom}</td><td className="px-4 py-3">{m.fields?.Cat√©gorie}</td><td className="px-4 py-3">{m.fields?.['Prix d\'achat unitaire HT']}‚Ç¨</td><td className="px-4 py-3">{m.fields?.Unit√©}</td><td className="px-4 py-3">{m.fields?.Fournisseur}</td><td className="px-4 py-3"><div className="flex gap-2"><button onClick={()=>{setEi(m.id);setNm(m.fields);setSf(true)}} className="p-2 bg-blue-100 rounded"><I.Edit/></button><button onClick={()=>dlm(m.id)} disabled={sy} className="p-2 bg-red-100 rounded disabled:opacity-50"><I.Trash/></button></div></td></tr>)}</tbody></table>{fm.length===0&&<div className="p-12 text-center text-gray-500">Aucune mati√®re premi√®re</div>}</div></div>}{t==='r'&&<div className="space-y-6"><div className="flex gap-4"><input type="text" placeholder="Rechercher..." value={q} onChange={e=>setQ(e.target.value)} className="flex-1 px-4 py-2 rounded border-2 outline-none"/><button onClick={()=>{setRf(true);setEr(null);setNr({'Produit / Plat':'',Ingr√©dient:'','Quantit√© utilis√©e':0,'Unit√© utilis√©e':'CL'})}} className="flex items-center gap-2 bg-purple-600 text-white px-6 py-2 rounded font-semibold"><I.Plus/>Nouveau</button></div>{rf&&<div className="bg-white rounded-xl p-4 border-2 border-purple-500"><h3 className="text-xl font-bold mb-4">{er?'Modifier':'Nouvelle'} Recette</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label className="block text-sm font-semibold mb-2">Produit/Plat *</label><input type="text" value={nr['Produit / Plat']} onChange={e=>setNr({...nr,'Produit / Plat':e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Ingr√©dient</label><input type="text" value={nr.Ingr√©dient} onChange={e=>setNr({...nr,Ingr√©dient:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Quantit√©</label><input type="number" step="0.1" value={nr['Quantit√© utilis√©e']} onChange={e=>setNr({...nr,'Quantit√© utilis√©e':parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Unit√©</label><select value={nr['Unit√© utilis√©e']} onChange={e=>setNr({...nr,'Unit√© utilis√©e':e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none">{us.map(u=><option key={u}>{u}</option>)}</select></div></div><div className="flex gap-3"><button onClick={svr} disabled={sy} className="bg-purple-600 text-white px-6 py-2 rounded font-semibold disabled:opacity-50">{sy?'Sauvegarde...':'Enregistrer'}</button><button onClick={()=>{setRf(false);setEr(null)}} className="bg-gray-300 px-6 py-2 rounded font-semibold">Annuler</button></div></div>}<div className="bg-white rounded-xl shadow-lg overflow-x-auto"><table className="w-full text-sm"><thead className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white"><tr>{['Produit/Plat','Ingr√©dient','Quantit√©','Unit√©','Actions'].map(h=><th key={h} className="px-4 py-3 text-left font-semibold">{h}</th>)}</tr></thead><tbody>{fr.map(r=><tr key={r.id} className="border-b hover:bg-gray-50"><td className="px-4 py-3 font-semibold">{r.fields?.['Produit / Plat']}</td><td className="px-4 py-3">{r.fields?.Ingr√©dient}</td><td className="px-4 py-3">{r.fields?.['Quantit√© utilis√©e']}</td><td className="px-4 py-3">{r.fields?.['Unit√© utilis√©e']}</td><td className="px-4 py-3"><div className="flex gap-2"><button onClick={()=>{setEr(r.id);setNr(r.fields);setRf(true)}} className="p-2 bg-blue-100 rounded"><I.Edit/></button><button onClick={()=>dlr(r.id)} disabled={sy} className="p-2 bg-red-100 rounded disabled:opacity-50"><I.Trash/></button></div></td></tr>)}</tbody></table>{fr.length===0&&<div className="p-12 text-center text-gray-500">Aucune recette</div>}</div></div>}{t==='p'&&<div className="space-y-6"><div className="flex gap-4"><input type="text" placeholder="Rechercher..." value={q} onChange={e=>setQ(e.target.value)} className="flex-1 px-4 py-2 rounded border-2 outline-none"/><button onClick={()=>{setPf(true);setEp(null);setNp({'Produit / Plat':'',Structure:'BAR',Type:'Cocktail','Prix de vente (‚Ç¨)':0,'Co√ªt mati√®re (‚Ç¨)':0,'Commission plateforme (%)':0})}} className="flex items-center gap-2 bg-purple-600 text-white px-6 py-2 rounded font-semibold"><I.Plus/>Nouveau</button></div>{pf&&<div className="bg-white rounded-xl p-4 border-2 border-purple-500"><h3 className="text-xl font-bold mb-4">{ep?'Modifier':'Nouveau'} Produit</h3><div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label className="block text-sm font-semibold mb-2">Nom *</label><input type="text" value={np['Produit / Plat']} onChange={e=>setNp({...np,'Produit / Plat':e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Structure</label><select value={np.Structure} onChange={e=>setNp({...np,Structure:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none">{sts.map(s=><option key={s}>{s}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Type</label><select value={np.Type} onChange={e=>setNp({...np,Type:e.target.value})} className="w-full px-4 py-2 border-2 rounded outline-none">{tps.map(t=><option key={t}>{t}</option>)}</select></div><div><label className="block text-sm font-semibold mb-2">Prix vente (‚Ç¨)</label><input type="number" step="0.01" value={np['Prix de vente (‚Ç¨)']} onChange={e=>setNp({...np,'Prix de vente (‚Ç¨)':parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Co√ªt mati√®re (‚Ç¨)</label><input type="number" step="0.01" value={np['Co√ªt mati√®re (‚Ç¨)']} onChange={e=>setNp({...np,'Co√ªt mati√®re (‚Ç¨)':parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div><div><label className="block text-sm font-semibold mb-2">Commission (%)</label><input type="number" step="0.1" value={np['Commission plateforme (%)']} onChange={e=>setNp({...np,'Commission plateforme (%)':parseFloat(e.target.value)||0})} className="w-full px-4 py-2 border-2 rounded outline-none"/></div></div><div className="flex gap-3"><button onClick={svp} disabled={sy} className="bg-purple-600 text-white px-6 py-2 rounded font-semibold disabled:opacity-50">{sy?'Sauvegarde...':'Enregistrer'}</button><button onClick={()=>{setPf(false);setEp(null)}} className="bg-gray-300 px-6 py-2 rounded font-semibold">Annuler</button></div></div>}<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{fp.map(p=>{const pv=p.fields?.['Prix de vente (‚Ç¨)']||0;const cm=p.fields?.['Co√ªt mati√®re (‚Ç¨)']||0;const mg=pv>0?((pv-cm)/pv*100):0;return(<div key={p.id} className="bg-white rounded-xl shadow-lg overflow-hidden"><div className="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white"><div className="flex justify-between"><div><h4 className="text-xl font-bold">{p.fields?.['Produit / Plat']}</h4><p className="text-sm">{p.fields?.Structure} - {p.fields?.Type}</p></div><span className="bg-white/20 px-3 py-1 rounded text-sm font-semibold">{pv}‚Ç¨</span></div></div><div className="p-4"><div className="space-y-2 mb-4"><div className="flex justify-between text-sm"><span>Co√ªt</span><span className="font-semibold">{cm}‚Ç¨</span></div><div className="flex justify-between text-sm"><span>Marge</span><span className="font-semibold text-green-600">{mg.toFixed(1)}%</span></div></div><div className="flex gap-2"><button onClick={()=>{setEp(p.id);setNp(p.fields);setPf(true)}} className="flex-1 bg-blue-100 text-blue-700 px-4 py-2 rounded font-semibold text-sm">Modifier</button><button onClick={()=>dlp(p.id)} disabled={sy} className="flex-1 bg-red-100 text-red-700 px-4 py-2 rounded font-semibold text-sm disabled:opacity-50">Supprimer</button></div></div></div>)})}</div>{fp.length===0&&<div className="bg-white rounded-xl p-12 text-center text-gray-500">Aucun produit</div>}</div>}</div></div>)}
ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>